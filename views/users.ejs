<!DOCTYPE html>
<!-- views/branches.ejs -->
<html lang="en">
<head>
    <% include partials-login/head %>
    <style>
* {
    margin: 0;
    padding: 0;
  }
  h3{
    font: 25px/1 Helvetica, Verdana, sans-serif;
  }
   
  .list {
    margin: 50px;
  }
   
  .list ul {
    overflow: hidden;
    overflow-y: auto;
    list-style-type: none;
  }
   
  .list li {
    /* height: 25px; */
    /* float: left; */
    margin-right: 0px;
    border-bottom: 1px solid #aaa;
    padding: 20px;
    text-decoration: none;
    font: 20px/1 Helvetica, Verdana, sans-serif;
    text-transform: uppercase;
   
    -webkit-transition: all 0.5s ease;
    -moz-transition: all 0.5s ease;
    -o-transition: all 0.5s ease;
    -ms-transition: all 0.5s ease;
    transition: all 0.5s ease;  }
   
  .list li:last-child {
    border-right: none;
  }
   
  .list li a {
    text-decoration: none;
    color: #ccc;
    font: 25px/1 Helvetica, Verdana, sans-serif;
    text-transform: uppercase;
   
    -webkit-transition: all 0.5s ease;
    -moz-transition: all 0.5s ease;
    -o-transition: all 0.5s ease;
    -ms-transition: all 0.5s ease;
    transition: all 0.5s ease;
  }
  /* Full-width input fields */
input[type=text], input[type=password] {
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    display: inline-block;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

/* Set a style for all buttons */
button {
    background-color: rgb(39, 151, 114);
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    cursor: pointer;
    width: 100%;
}

button:hover{
    background-color: rgb(45, 218, 218);
}
/* Extra styles for the cancel button */
.cancelbtn {
    padding: 14px 20px;
    background-color: #f44336;
}

/* Float cancel and signup buttons and add an equal width */
.cancelbtn,.signupbtn {
    float: left;
    width: 50%;
}

/* Add padding to container elements */
.container {
    padding: 16px;
}

/* Clear floats */
.clearfix::after {
    content: "";
    clear: both;
    display: table;
}
.flex {
    display: -webkit-box;
    display: -moz-box;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
}

.flex-child {
    -webkit-box-flex: 1 1 auto;
    -moz-box-flex:  1 1 auto;
    -webkit-flex:  1 1 auto;
    -ms-flex:  1 1 auto;
    flex:  1 1 auto;
}
/* Change styles for cancel button and signup button on extra small screens */
@media screen and (max-width: 300px) {
    .cancelbtn, .signupbtn {
        width: 100%;
    }
}
    </style>
</head>
<body class="container">
    <header>  
            <% if(!login){%>
                <% include partials-login/header %>          
            <%} else{ %>
                <%include partials-logout/header %>           
                <%}%>
           
    </header>
    <main>
        <h3>Users</h3>
        <!-- Button to open the modal -->
<button onclick="document.getElementById('id01').style.display='block'">Add User</button>

<!-- The Modal (contains the Sign Up form) -->
<div id="id01" class="modal">
  <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
  <form class="modal-content animate" id="add-user-form" role="form">
    <div class="container">
      <label><b>User Name</b></label>
      <input type="text" placeholder="Enter User Name" id="username" name="username" required>

      <label><b>Password</b></label>
      <input type="password" placeholder="Enter Password" id="psw1" name="psw1" required>

      <label><b>Repeat Password</b></label>
      <input type="password" placeholder="Repeat Password" id="psw-repeat" name="psw-repeat" required>
      <label><b>Choose Category</b></label></br>
    
        <input type="radio"  name="category" value="1">Worker            
    
      <input type="radio"  name="category" value="2">Customer </br></br>
      <p>By creating an account you agree to our <a href="#">Terms & Privacy</a>.</p>

      <div class="clearfix">
        <button type="button" onclick="document.getElementById('id01').style.display='none'" class="cancelbtn">Cancel</button>
        <button type="submit" class="signupbtn">Sign Up</button>
      </div>
    </div>
    <script>
        $('#add-user-form').submit(function(e){
            e.preventDefault();
          $.ajax({
            type: "POST",
            url: 'http://localhost:3000/signUp',
            body: 'data',
            data:{
              'username':$("#username").val(),
              'password': $("#psw1").val(),
              'passwordRe':$("#psw-repeat").val(),
              'cat':$("#category").val()
            },
            success: function(data){
        alert("Add user successfully complete");
    },
            error: function(data)
            {
              alert("Add user failed");
            }
          });
      });
      </script>
  </form>
</div>
           
<div class="list">

<ul id="myList">
        <% users.forEach(function(user) { %>
            <%if (user.activate==true) {%>
            <li> <b>User Name:</b> <div id="usrnm"><%= user.username %></div>
                <%if (0==0){%>
                </br> <b>Password:</b> <div id="pssw"><%=user.password%></div>
            <%}%>
            </br> <b>Category:</b> <%= user.category %>
            <%if (0==0){%>
            <div class="flex">
                <button type="button" class="flex-child" onclick="updateUser('<%= user.username %>','<%=user.password%>')">Update</button>
            
                <button type="button" class="flex-child" onclick="deleteUser('<%= user.username %>','<%=user.password%>')">Delete</button>
            </div>
            <%}%>
            <script>
                function deleteUser(user,pass){
                    $.ajax({
                        type: "POST",
                        url:'http://localhost:8070/delete',
                        body:'data',
                        data:{
                            'username':user,
                            'password':pass    
                        },
                        success:function(data){
                            location.reload();
                            alert("Delete user successfully complete");
                        },
                        error:function(data){
                            alert("Delete user failed");
                        }
                    })
                }

                function updateUser(user,pass){

                    var popUpList = $('<div><input type="radio">Manager<br><input type="radio">Worker<br><input type="radio">Consumer</div>');
                    bootbox.prompt({
                        inputType: 'checkbox',
                        inputOptions: [
                            {
                                text: 'Manager',
                                value: '0',
                            },
                            {
                                text: 'Worker',
                                value: '1',
                            },
                            {
                                text: 'Consumer',
                                value: '2',
                            }
                        ],
                        callback: function (result) {
                            $.ajax({
                        type:"POST",
                        url: 'http://localhost:8070/update',
                        body: 'data',
                        data: {
                            'username':user,
                            'password':pass,
                            'cat':result[0]
                        },
                        success:function(data){
                            location.reload();
                            alert("Update user successfully complete");
                        },
                        error: function(data){
                            alert("Update user failed");
                        }
                    })
                        }
                    });                 
                       
                }
            </script>
        </li>
        <%}%>
        <% }); %>
</ul>
</div>

</main>
<footer>
    <% include partials-login/footer %>
</footer>
</body>
</html>    